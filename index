<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Advance Valves – Quotation Calculator | Vijay Sales Corporation</title>

<style>
  :root{ --brand:#24364e; }
  body{font-family:Arial,Helvetica,sans-serif;background:#f7f8fb;color:#333;margin:0}
  header{background:var(--brand);color:#fff;padding:10px 14px;text-align:center;font-weight:bold}
  main{max-width:980px;margin:24px auto;padding:0 16px}
  h1{color:var(--brand);margin:6px 0 14px}
  .card{background:#fff;border-radius:8px;box-shadow:0 2px 10px rgba(0,0,0,.06);padding:16px;margin:14px 0}
  label{display:block;margin:10px 0 6px;font-weight:600}
  select,input{width:100%;padding:10px;border:1px solid #ccd1d9;border-radius:6px;background:#fff}
  .row{display:grid;gap:12px}
  @media(min-width:720px){ .row.cols-2{grid-template-columns:1fr 1fr} .row.cols-3{grid-template-columns:1fr 1fr 1fr} .row.cols-4{grid-template-columns:1fr 1fr 1fr 1fr}}
  .btn{background:var(--brand);color:#fff;border:none;border-radius:8px;padding:10px 16px;font-weight:700;cursor:pointer}
  .btn.secondary{background:#fff;color:var(--brand);border:2px solid var(--brand)}
  .btn:disabled{opacity:.6;cursor:not-allowed}
  table{width:100%;border-collapse:collapse;margin-top:10px}
  th,td{border:1px solid #e3e6eb;padding:10px;text-align:center}
  th{background:var(--brand);color:#fff}
  tfoot td{font-weight:700}
  .flex{display:flex;gap:10px;flex-wrap:wrap}
  .right{justify-content:flex-end}
  .muted{color:#666;font-size:12px}
</style>

<!-- jsPDF + AutoTable for PDF -->
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.8.4/dist/jspdf.plugin.autotable.min.js"></script>
</head>
<body>
<header>
  Vijay Sales Corporation • sales@vijaysalescorp.com • +91 9999889008
</header>

<main>
  <h1>Advance Valves – Price & Quotation Calculator</h1>

  <div class="card">
    <div class="row cols-4">
      <div>
        <label for="category">Product</label>
        <select id="category"></select>
      </div>
      <div>
        <label for="size">Size (NB)</label>
        <select id="size"></select>
      </div>
      <div id="opWrap" style="display:none">
        <label for="operation">Operation</label>
        <select id="operation"></select>
      </div>
      <div>
        <label for="qty">Quantity (pcs)</label>
        <input type="number" id="qty" value="1" min="1"/>
      </div>
    </div>

    <div class="row cols-3" style="margin-top:12px">
      <div>
        <label for="unitPrice">Price / pc (₹)</label>
        <input type="text" id="unitPrice" readonly/>
      </div>
      <div>
        <label for="discount">Discount (%)</label>
        <input type="number" id="discount" value="0" min="0" max="100" step="0.5"/>
      </div>
      <div>
        <label>&nbsp;</label>
        <button class="btn" onclick="addItem()">Add to Quotation</button>
      </div>
    </div>

    <p class="muted">Notes: Base prices shown are exclusive of GST. GST @18% optional below. Freight as actual. Price at time of dispatch applies.</p>
  </div>

  <div class="card">
    <h2 style="margin:0 0 10px">Quotation Summary</h2>
    <table id="quoteTable">
      <thead>
        <tr>
          <th>Product</th>
          <th>Size (NB)</th>
          <th>Operation</th>
          <th>Unit Price (₹)</th>
          <th>Qty</th>
          <th>Line Total (₹)</th>
          <th>Remove</th>
        </tr>
      </thead>
      <tbody></tbody>
      <tfoot>
        <tr>
          <td colspan="5" style="text-align:right">Sub-Total</td>
          <td id="subTotal">₹0</td>
          <td></td>
        </tr>
        <tr>
          <td colspan="3">
            <label class="muted"><input type="checkbox" id="gstToggle" onchange="recalc()"> Apply GST 18%</label>
          </td>
          <td colspan="2" style="text-align:right">GST (18%)</td>
          <td id="gstAmt">₹0</td>
          <td></td>
        </tr>
        <tr>
          <td colspan="3">
            <label>Freight / Other (₹)</label>
            <input type="number" id="freight" value="0" min="0" oninput="recalc()" style="width:160px"/>
          </td>
          <td colspan="2" style="text-align:right">Grand Total</td>
          <td id="grandTotal">₹0</td>
          <td></td>
        </tr>
      </tfoot>
    </table>

    <div class="flex right" style="margin-top:14px">
      <button class="btn" onclick="downloadPDF()">Download PDF</button>
      <button class="btn secondary" onclick="sendWA()">Send via WhatsApp</button>
      <button class="btn secondary" onclick="resetAll()">Reset</button>
    </div>
  </div>

  <p class="muted">
    Price data source: Advance Valves price list (w.e.f. 21/03/2022). GST extra. Freight as actual. <!-- data source citation kept in chat -->
  </p>
</main>

<script>
/* ---- PRICE DATA (₹/pc) — from your uploaded PDF ---- */
const ADV_DATA = {
  "Butterfly Valve PN1.0": {
    prices: { "50":2466, "65":2653, "80":2840, "100":3714, "125":4495, "150":5181, "200":11766 },
    operationBySize: { "50":"Lever","65":"Lever","80":"Lever","100":"Lever","125":"Lever","150":"Lever","200":"Gear" }
  },
  "Butterfly Valve PN16": {
    prices: { "50":2716,"65":2934,"80":3090,"100":4089,"125":4932,"150":5681,"200":12965,"250":19102,"300":26344 },
    operationBySize: { "50":"Lever","65":"Lever","80":"Lever","100":"Lever","125":"Lever","150":"Lever","200":"Lever","250":"Gear","300":"Gear" }
  },
  "Butterfly Valve PN16 (SS-410 Disc)": {
    prices: { "50":2934,"65":3090,"80":3371,"100":4557,"125":5681,"150":6555,"200":11145,"200-Gear":14585,"250-Gear":23597,"300-Gear":33211,"350-Gear":50940 },
    // special handling: 200 has both Lever & Gear; 250/300/350 are Gear only; others assumed Lever
    operationBySize: {} // will be computed dynamically below
  },
  "Butterfly Valve PN20 (SS-304 Disc)": {
    prices: { "50":11766 },
    operationBySize: { "50":"Lever" }
  },
  "Dual Plate NRV PN16": {
    prices: { "50":2310,"65":2622,"80":3184,"100":4620,"125":6680,"150":8178,"200":14483,"250":21849,"300":34709 },
    operationBySize: {}
  },
  "Bronze Balancing Valve (Threaded)": {
    prices: { "25":4370,"32":6555,"40":7304,"50":10675 },
    operationBySize: {}
  },
  "CI Balancing Valve (Flanged End)": {
    prices: { "65":11549,"80":13172,"100":18978,"125":26094,"150":34834,"200":68544,"250":128598,"300":167302 },
    operationBySize: {}
  }
};

// Build operationBySize for the SS-410 group (to support 200 Lever/Gear)
(function(){
  const op = {};
  Object.keys(ADV_DATA["Butterfly Valve PN16 (SS-410 Disc)"].prices).forEach(k=>{
    if(k==="200") op["200"]="Lever";
    else if(k==="200-Gear") op["200-Gear"]="Gear";
    else if(k.endsWith("-Gear")) op[k]="Gear";
    else op[k]="Lever";
  });
  ADV_DATA["Butterfly Valve PN16 (SS-410 Disc)"].operationBySize = op;
})();

/* ---- UI elements ---- */
const $cat = document.getElementById('category');
const $size = document.getElementById('size');
const $opWrap = document.getElementById('opWrap');
const $op = document.getElementById('operation');
const $qty = document.getElementById('qty');
const $unit = document.getElementById('unitPrice');
const $tbody = document.querySelector('#quoteTable tbody');
const $sub = document.getElementById('subTotal');
const $gstToggle = document.getElementById('gstToggle');
const $gstAmt = document.getElementById('gstAmt');
const $freight = document.getElementById('freight');
const $grand = document.getElementById('grandTotal');

let rows = [];

/* ---- populate Category ---- */
(function init(){
  Object.keys(ADV_DATA).forEach(k=>{
    const opt = document.createElement('option');
    opt.value = k; opt.textContent = k;
    $cat.appendChild(opt);
  });
  onCategory();
})();

$cat.addEventListener('change', onCategory);
$size.addEventListener('change', onSize);
$op.addEventListener('change', updateUnitPrice);

function onCategory(){
  $size.innerHTML = '';
  $op.innerHTML = '';
  $opWrap.style.display = 'none';

  const group = ADV_DATA[$cat.value];
  const sizes = Object.keys(group.prices)
    .map(s=>s) // keep special keys like '200-Gear'
    .filter(s=>!s.includes('-Gear')) // default list shows numeric sizes
    .sort((a,b)=>parseInt(a)-parseInt(b));

  // For SS-410 group, also ensure 200 is in list (lever shown as 200; gear handled via op dropdown)
  sizes.forEach(s=>{
    const o = document.createElement('option');
    o.value = s; o.textContent = s;
    $size.appendChild(o);
  });
  if(sizes.length){ $size.value = sizes[0]; }

  onSize();
}

function onSize(){
  const cat = $cat.value;
  const size = $size.value;

  // Decide if operation dropdown is needed
  let ops = [];
  if(cat==="Butterfly Valve PN16 (SS-410 Disc)"){
    if(size==="200"){ ops = ["Lever","Gear"]; }
    else if(["250","300","350"].includes(size)){ ops = ["Gear"]; }
    else { ops = ["Lever"]; }
  } else if(cat==="Butterfly Valve PN1.0"){
    ops = (size==="200")?["Gear"]:["Lever"];
  } else if(cat==="Butterfly Valve PN16"){
    if(["250","300"].includes(size)) ops=["Gear"]; else ops=["Lever"];
  }

  if(ops.length){
    $opWrap.style.display = '';
    $op.innerHTML = '';
    ops.forEach(v=>{
      const o = document.createElement('option');
      o.value = v; o.textContent = v;
      $op.appendChild(o);
    });
  } else {
    $opWrap.style.display = 'none';
    $op.innerHTML = '';
  }
  updateUnitPrice();
}

function updateUnitPrice(){
  const cat = $cat.value;
  let sizeKey = $size.value;

  // Handle special price keys for SS-410 Gear on 200, 250, 300, 350
  if(cat==="Butterfly Valve PN16 (SS-410 Disc)"){
    const op = ($opWrap.style.display!=='none') ? $op.value : 'Lever';
    if(op==="Gear" && (sizeKey==="200"||sizeKey==="250"||sizeKey==="300"||sizeKey==="350")){
      if(sizeKey==="200") sizeKey = "200-Gear";
      else sizeKey = sizeKey+"-Gear";
    }
  }

  const price = ADV_DATA[cat].prices[sizeKey];
  $unit.value = price ? price.toLocaleString('en-IN') : '';
}

function addItem(){
  const cat = $cat.value;
  let size = $size.value;
  const qty = Math.max(1, parseInt($qty.value||'1',10));
  const op = ($opWrap.style.display!=='none') ? $op.value : '';
  let sizeKey = size;

  if(cat==="Butterfly Valve PN16 (SS-410 Disc)" && op==="Gear"){
    if(size==="200") sizeKey="200-Gear"; else sizeKey = size+"-Gear";
  }

  const unit = ADV_DATA[cat].prices[sizeKey];
  if(!unit) return alert('Invalid selection');

  const discountPct = Math.max(0, Math.min(100, parseFloat(document.getElementById('discount').value||'0')));
  const unitAfterDisc = unit * (1 - discountPct/100);
  const line = unitAfterDisc * qty;

  const row = {cat, size, op, unit, discountPct, qty, total: line};
  rows.push(row);
  renderRows();
  // reset qty only
  $qty.value = 1;
}

function renderRows(){
  $tbody.innerHTML = '';
  rows.forEach((r,idx)=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${r.cat}</td>
      <td>${r.size}</td>
      <td>${r.op||'-'}</td>
      <td>₹${(r.unit*(1-r.discountPct/100)).toLocaleString('en-IN',{maximumFractionDigits:2})}</td>
      <td>${r.qty}</td>
      <td>₹${r.total.toLocaleString('en-IN',{maximumFractionDigits:2})}</td>
      <td><button class="btn secondary" onclick="removeRow(${idx})">X</button></td>
    `;
    $tbody.appendChild(tr);
  });
  recalc();
}

function removeRow(i){
  rows.splice(i,1);
  renderRows();
}

function recalc(){
  const sub = rows.reduce((a,b)=>a+b.total,0);
  $sub.textContent = "₹"+sub.toLocaleString('en-IN',{maximumFractionDigits:2});
  const gst = $gstToggle.checked ? sub*0.18 : 0;
  $gstAmt.textContent = "₹"+gst.toLocaleString('en-IN',{maximumFractionDigits:2});
  const freight = Math.max(0, parseFloat($freight.value||'0'));
  const grand = sub + gst + freight;
  $grand.textContent = "₹"+grand.toLocaleString('en-IN',{maximumFractionDigits:2});
}

function resetAll(){
  rows = [];
  renderRows();
  document.getElementById('discount').value = 0;
  $freight.value = 0; $gstToggle.checked = false;
  recalc();
}

/* ---- PDF ---- */
function downloadPDF(){
  recalc();
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  doc.setFontSize(14);
  doc.text('Advance Valves – Quotation', 14, 14);
  doc.setFontSize(10);
  doc.text('Vijay Sales Corporation • sales@vijaysalescorp.com • +91 9999889008',14,20);

  const body = rows.length? rows.map(r=>[
    r.cat, r.size, (r.op||'-'),
    `INR ${(r.unit*(1-r.discountPct/100)).toLocaleString('en-IN',{maximumFractionDigits:2})}`,
    r.qty, `INR ${r.total.toLocaleString('en-IN',{maximumFractionDigits:2})}`
  ]) : [['-','-','-','-','-','-']];

  doc.autoTable({
    startY: 26,
    head: [['Product','Size (NB)','Operation','Unit (INR)','Qty','Line Total (INR)']],
    body
  });

  const y = (doc.lastAutoTable?.finalY || 26) + 8;
  const sub = document.getElementById('subTotal').innerText.replace(/[₹,]/g,'').trim();
  const gst = document.getElementById('gstAmt').innerText.replace(/[₹,]/g,'').trim();
  const freight = parseFloat(document.getElementById('freight').value||'0');
  const grand = document.getElementById('grandTotal').innerText.replace(/[₹,]/g,'').trim();

  doc.setFontSize(11);
  doc.text(`Sub-Total: INR ${Number(sub).toLocaleString('en-IN',{maximumFractionDigits:2})}`,14,y);
  doc.text(`GST (18%): INR ${Number(gst).toLocaleString('en-IN',{maximumFractionDigits:2})}`,14,y+6);
  doc.text(`Freight/Other: INR ${freight.toLocaleString('en-IN',{maximumFractionDigits:2})}`,14,y+12);
  doc.setFont(undefined,'bold');
  doc.text(`Grand Total: INR ${Number(grand).toLocaleString('en-IN',{maximumFractionDigits:2})}`,14,y+20);
  doc.setFont(undefined,'normal');
  doc.setFontSize(9);
  doc.text('Notes: Prices exclusive of GST. Freight as actual. Price at time of dispatch applies.',14,y+28);

  doc.save('Advance-Valves-Quotation.pdf');
}

/* ---- WhatsApp ---- */
function sendWA(){
  recalc();
  let msg = 'Advance Valves Quotation – Vijay Sales Corporation\n\n';
  if(!rows.length){ msg += '(No items added)\n'; }
  rows.forEach(r=>{
    msg += `• ${r.cat} | ${r.size} NB ${r.op? '| '+r.op : ''} | Qty ${r.qty} | Unit ₹${(r.unit*(1-r.discountPct/100)).toLocaleString('en-IN',{maximumFractionDigits:2})} | Line ₹${r.total.toLocaleString('en-IN',{maximumFractionDigits:2})}\n`;
  });
  const sub = document.getElementById('subTotal').innerText;
  const gst = document.getElementById('gstAmt').innerText;
  const freight = Number(document.getElementById('freight').value||0).toLocaleString('en-IN',{maximumFractionDigits:2});
  const grand = document.getElementById('grandTotal').innerText;
  msg += `\nSub-Total: ${sub}\nGST (18%): ${gst}\nFreight/Other: ₹${freight}\nGrand Total: ${grand}\n\n`;
  msg += `Contact: 9999889008 • sales@vijaysalescorp.com`;

  const url = `https://wa.me/919999889008?text=${encodeURIComponent(msg)}`;
  window.open(url,'_blank');
}
</script>
</body>
</html>
